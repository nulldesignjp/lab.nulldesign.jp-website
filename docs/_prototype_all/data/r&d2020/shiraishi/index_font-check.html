<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Language" content="ja">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="imagetoolbar" content="no">
<meta http-equiv="cleartype" content="on">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes, viewport-fit=cover">
<meta name="keywords" content="">
<meta name="description" content="">
<link href="https://fonts.googleapis.com/css?family=Heebo:100,400&display=swap&subset=hebrew" rel="stylesheet">
<!--<link href="assets/css/reset.css" rel="stylesheet" type="text/css" media="all">
<link href="assets/css/style.css" rel="stylesheet" type="text/css" media="all">-->
<title>shiraishi prototype</title>
<style>
html,body{
	margin: 0;
	padding: 0;
}
.hide{
	display: none;
}
#hideArea{
	display: none;
}

img{
	position: fixed;
	left: 0;
	top: 0;
	z-index: -1;
	opacity: 0.4;
}

svg{
	position: fixed;
	left: 0;
	top: 0;
	z-index: 1;
}
</style>
</head>
<body>
<div id="webglView"><!--/ webglView --></div>
<div id="hideArea"></div>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="downloadSVG.js"></script>
<script type="text/javascript">
//	フロントお渡し箇所
window.addEventListener( 'DOMContentLoaded', function(){

	var _colorImage = 'master.png';
	var _layoutImage = 'layout.png';

	var _fontSizeMaster = 16;
	var _fontSize = 16;
	var _margin = 0;
	var _px = 0;
	var _py = 0;

	var width = 1920;
	var height = 1080;

	var _img0 = new Image();	//	color
	var _img1 = new Image();	//	layout

	var _canvas0 = document.createElement('canvas');
	var _canvas1 = document.createElement('canvas');
	var _ctx0 = _canvas0.getContext('2d');
	var _ctx1 = _canvas1.getContext('2d');
	var _data0;
	var _data1;

	document.getElementById("hideArea").appendChild( _canvas0 );
	document.getElementById("hideArea").appendChild( _canvas1 );

	var svgtext, textspoint, textsSelection;
	var _message = 0;
	var _textcount = 0;

	_drawSVG()


	function _drawSVG()
	{
		svgtext = d3.select("#webglView")
		.append("svg")
		.attr("width",width)
		.attr("height",height);


		textspoint = [];
		var _checkString = '白石麻衣 感謝卒業感動 しらいしまい nogizaka SHIRAISHI 0123456789.';
		var _fontCheck = [1,2,4,8,16,32,64,128,256];

		var _posY = 32;
		for( var i = 0; i < _fontCheck.length; i++ )
		{
			_fontCheck[i] *= 9;

			textspoint.push({
				text: _fontCheck[i]+'px ' + _checkString,
				size: _fontCheck[i],
				x: 32,
				y: _posY
			})

			_posY += _fontCheck[i] * 2 + 1;
		}

		textsSelection = svgtext
	      .append('g')
	      //.attr('transform','translate('+ width/2 +',' + height/2 + ')')
	      .attr('transform','translate('+ _px +',' + _py + ')')
	      .selectAll('text.numbers')
	      .data(textspoint)
	      .enter();

	    textsSelection.append('text')
	      // .attr("fill", 'rgba(0, 0, 0, 0.8)')
	      //.attr("text-anchor", 'middle')
	      .attr("text-anchor", 'left')
	      .attr("font-size", function(d,i) {
	          return d.size + "px";
	      })
	      .attr("fill", function(d,i){
	      	return 'rgba(0,0,0,1.0)';
	      })
	      .attr("x", function(d,i) {
	      		return d.x;
	      })
	      .attr("y", function(d,i) {
	      		return d.y;
	      })
	      // .attr("font-family", 'YuMincho')
	      .attr("font-family", 'YuGothic')
	      //.attr('dominant-baseline','text-before-edge')		//	http://defghi1977.html.xdomain.jp/tech/svgMemo/svgMemo_08.htm
	      													//	https://www.saburo.org/shell/2019/01/dominant_baseli.html
	      													//	https://www.adobe.com/jp/svg/indepth/properties.html	
	      .text(function(d,i) {
	      	return d.text;
	      })
	      .each(function(d,i){
	      	// console.log( i, d, this.getBBox(), 'text-before-edge')
	      	console.log( this.getBBox())



	      });

	      //console.log(textsSelection)

	      d3.select("body").append("button")
	        .attr("type","button")
	        .attr("class", "downloadButton")
	        .text("Download SVG")
	        .on("click", function() {
	            // download the svg
	            downloadSVG();
	        });

	        _py = 0;
	}

})



function shuffleArray( array )
{
	for(var i = array.length - 1; i > 0; i--){
		var r = Math.floor(Math.random() * (i + 1));
		var tmp = array[i];
		array[i] = array[r];
		array[r] = tmp;
		return array;
	}
}

</script>
</body>
</html>
