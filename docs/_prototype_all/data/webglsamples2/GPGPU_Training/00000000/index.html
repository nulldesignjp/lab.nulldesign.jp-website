<!doctype html>
<html>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
<meta charset="UTF-8">
<meta http-equiv="Content-Language" content="ja">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="imagetoolbar" content="no">
<meta http-equiv="cleartype" content="on">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes, viewport-fit=cover">
<meta name="keywords" content="">
<meta name="description" content="">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://nulldesign.jp/metrogram3d/shared/img/120x120.png">
<link href="http://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet" type="text/css">
<link href="shared/css/reset.css" rel="stylesheet" type="text/css" media="all">
<link href="shared/css/style.css" rel="stylesheet" type="text/css" media="all">
<title>Draw</title>
</head>
<body>
<div id="container">
<div id="siteHead">
<h1>GPGPU</h1>
<h2>with WebGL</h2>
<!--/ siteHead --></div>
<div id="siteBody">
<div id="webglView"><!--/ webglView --></div>
<!--/ siteBody --></div>
<div id="siteFoot"><p>COPYRIGHT &copy; 2018 nulldesign.jp <br>ALL RIGHTS RESERVED.</p>
<!--/ siteFoot --></div>
<!--/ container --></div>
<script type="x-shader/x-vertex" id="vertexshader">
uniform float time;

attribute vec3 offset;
attribute float life;

varying vec3 pos;
varying vec3 vNormal;
varying vec2 vUv;

const float PI = 3.14159265;


vec2 random2(vec2 st){
       vec2 _st = vec2( dot(st,vec2(127.1,311.7)),
                      dot(st,vec2(269.5,183.3)));
       return -1.0 + 2.0 * fract( sin(_st) * 43758.5453123 );
   }

float perlinNoise(vec2 st)
{
    vec2 p = floor(st);
    vec2 f = fract(st);
    vec2 u = f*f*(3.0-2.0*f);

    vec2 v00 = random2( p + vec2(0,0) );
    vec2 v10 = random2( p + vec2(1,0) );
    vec2 v01 = random2( p + vec2(0,1) );
    vec2 v11 = random2( p + vec2(1,1) );

    return mix( mix( dot( v00, f - vec2(0,0) ), dot( v10, f - vec2(1,0) ), u.x ),
                 mix( dot( v01, f - vec2(0,1) ), dot( v11, f - vec2(1,1) ), u.x ),
                 u.y ) + 0.5;
}

float fBm (vec2 st)
{
    float f = 0.0;
    vec2 q = st;

    f += 0.5000 * perlinNoise( q ); q = q*2.01;
    f += 0.2500 * perlinNoise( q ); q = q*2.02;
    f += 0.1250 * perlinNoise( q ); q = q*2.03;
    f += 0.0625 * perlinNoise( q ); q = q*2.01;

    return f;
}

mat2 rotate2d(float angle){
    return mat2(cos(angle),-sin(angle),
                sin(angle),cos(angle));
}

mat3 scale(vec3 _scale){
    return mat3(_scale.x,0.0,0.0,
                0.0,_scale.y,0.0,
                0.0,0.0,_scale.z);
}

void main()
{
    vec3 _pos = position;
    _pos.xz = _pos.xz * rotate2d( fBm( vec2(time * 0.25, length( offset ) ) ) * PI * 16.0 );
    _pos.zy = _pos.zy * rotate2d( fBm( vec2(time * 0.25, length( offset ) ) ) * PI * 16.0 );

    float _pseudoRad = mod( life + time, 1.0 ) * 3.1416 * 2.0 - 3.11416 * 0.5;
    float _scale = sin( _pseudoRad )  * 0.5 + 0.5;
    _pos = _pos * scale( vec3( _scale ) );
    //_pos = _pos * scale( vec3( life ) );

	pos = _pos + offset;
    float _m = mod( life + time, 1.0 ) * 64.0;
    pos.x += fBm( offset.yz * 0.1 + time * 0.2 ) * _m - _m * 0.5;
    pos.y += fBm( offset.zx * 0.1 + time * 0.2 ) * _m - _m * 0.5;
    pos.z += fBm( offset.xy * 0.1 + time * 0.2 ) * _m - _m * 0.5; 


    vUv = uv;
    vNormal = normalMatrix * normal;

	gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );
}
</script>
<script type="x-shader/x-fragment" id="fragmentshader">
uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;

uniform vec3 planeColor;
uniform vec3 lightPosition;
uniform vec3 lightColor;
uniform vec3 ambientColor;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 pos;
varying vec3 vNormal;
varying vec2 vUv;

float random (in vec2 st) {
    return fract(sin(dot(st.xy,
                         vec2(12.9898,78.233)))
                 * 43758.5453123);
}

float noise (in vec2 st) {
    vec2 i = floor(st);
    vec2 f = fract(st);

    // Four corners in 2D of a tile
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));

    // Smooth Interpolation

    // Cubic Hermine Curve.  Same as SmoothStep()
    vec2 u = f*f*(3.0-2.0*f);
    // u = smoothstep(0.,1.,f);

    // Mix 4 coorners porcentages
    return mix(a, b, u.x) +
            (c - a)* u.y * (1.0 - u.x) +
            (d - b) * u.x * u.y;
}

mat2 rotate2d(float angle){
    return mat2(cos(angle),-sin(angle),
                sin(angle),cos(angle));
}

float lines(in vec2 pos, float b){
    float scale = 10.0;
    pos *= scale;
    return smoothstep(0.0,
                    .5+b*.5,
                    abs((sin(pos.x*3.1415)+b*2.0))*.5);
}

void main()
{
  	vec2 uv = gl_FragCoord.xy / resolution.xy;
  	gl_FragColor = vec4(uv,0.5+0.5*sin(time),1.0);

    float pattern = pos.z;
    vec2 _pos = rotate2d( noise(pos.xy * 2.0 + time * 0.02) ) * pos.xy;
    pattern = lines(_pos.xy * 0.005 + time * 0.05,.5);
    pattern = pow( pattern, 2.0 );
    gl_FragColor *= vec4( vec3(pattern), 1.0 );

    vec4 viewLightPosition = viewMatrix * vec4( lightPosition, 0.0 );
    vec3 N = normalize( vNormal );
    vec3 L = normalize( viewLightPosition.xyz );
    float dotNL = dot( N, L );
    vec3 diffuse = planeColor * lightColor * max( dotNL, 0.0 );
    vec3 ambient = planeColor * ambientColor;

    gl_FragColor *= vec4( diffuse + ambient, 1.0 );


    //  FOG
    #ifdef USE_FOG
        #ifdef USE_LOGDEPTHBUF_EXT
            float depth = gl_FragDepthEXT / gl_FragCoord.w;
        #else
            float depth = gl_FragCoord.z / gl_FragCoord.w;
        #endif
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
    #endif

}
</script>
<script type="text/javascript" src="shared/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="shared/js/three.min.js"></script>
<script type="text/javascript" src="shared/js/SceneUtils.js"></script>
<script type="text/javascript" src="shared/js/OrbitControls.js"></script>
<script type="text/javascript" src="shared/js/world.js"></script>
<script type="text/javascript" src="shared/js/CopyShader.js"></script>
<script type="text/javascript" src="shared/js/EffectComposer.js"></script>
<script type="text/javascript" src="shared/js/MaskPass.js"></script>
<script type="text/javascript" src="shared/js/RenderPass.js"></script>
<script type="text/javascript" src="shared/js/ShaderPass.js"></script>
<script type="text/javascript" src="shared/js/BadTVShader.js"></script>
<script type="text/javascript" src="shared/js/VignetteShader.js"></script>
<script type="text/javascript" src="shared/js/ConvolutionShader.js"></script>
<script type="text/javascript" src="shared/js/BloomPass.js"></script>
<script type="text/javascript" src="shared/js/inflate.min.js"></script>
<script type="text/javascript" src="shared/js/FBXLoader.js"></script>
<script type="text/javascript" src="shared/js/OBJLoader.js"></script>
<script type="text/javascript" src="shared/js/engine.js"></script>
</body>
</html>
