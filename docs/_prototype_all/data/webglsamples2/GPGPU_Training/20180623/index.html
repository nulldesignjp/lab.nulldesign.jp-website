<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Language" content="ja">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="imagetoolbar" content="no">
<meta http-equiv="cleartype" content="on">
<meta name="keywords" content="">
<meta name="description" content="">
<link href="http://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet" type="text/css">
<title>nulldesign.study</title>
<style>
body{
    background: #CCC;
    font-family: 'EB Garamond', serif !important;
    font-family: Georgia !important;
}
</style>
</head>
<body>
<h1>nulldesign.study</h1>
<div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px; font-family: Georgia; width: 300px;">Italian<span style="color:white; text-shadow:0 0 2px blue;">Pizza</span></div>

<div><canvas id="foo" style="border: 3px solid #999;"></canvas></div>
<script type="text/javascript" src="jquery-3.3.1.min.js"></script>
<script>
var canvas = document.getElementById('foo');
var ctx = canvas.getContext('2d');

if (!HTMLCanvasElement.prototype.toBlob) {
   Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {
     value: function (callback, type, quality) {
       var canvas = this;
       setTimeout(function() {
         var binStr = atob( canvas.toDataURL(type, quality).split(',')[1] ),
         len = binStr.length,
         arr = new Uint8Array(len);

         for (var i = 0; i < len; i++ ) {
            arr[i] = binStr.charCodeAt(i);
         }

         callback( new Blob( [arr], {type: type || 'image/png'} ) );
       });
     }
  });
}

var data = '<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200">' +
           '<foreignObject width="100%" height="100%">' +
           '<div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px; font-family: Georgia; font-weight: bold;">' +
             'Italian ' +
             '<span style="color:white; text-shadow:0 0 2px blue;">' +
             'Pizza</span>' +
           '</div>' +
           '</foreignObject>' +
           '</svg>';
    
 data = encodeURIComponent(data);

 
var img = new Image();

img.onload = function() {
  ctx.drawImage(img, 0, 0);
  console.log(canvas.toDataURL());
 
  canvas.toBlob(function(blob) {
     var newImg = document.createElement('img'),
     url = URL.createObjectURL(blob);

     newImg.onload = function() {
     // no longer need to read the blob so it's revoked
     URL.revokeObjectURL(url);
   };

   newImg.src = url;
   document.body.appendChild(newImg);
 });
}

img.src = "data:image/svg+xml," + data




</script>
</body>
</html>
