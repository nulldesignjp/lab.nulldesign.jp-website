<!doctype html>
<html>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
<meta charset="UTF-8">
<meta http-equiv="Content-Language" content="ja">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="imagetoolbar" content="no">
<meta http-equiv="cleartype" content="on">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes, viewport-fit=cover">
<meta name="keywords" content="">
<meta name="description" content="">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://nulldesign.jp/metrogram3d/shared/img/120x120.png">
<link href="http://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet" type="text/css">
<link href="shared/css/reset.css" rel="stylesheet" type="text/css" media="all">
<link href="shared/css/style.css" rel="stylesheet" type="text/css" media="all">
<title>nulldesign.study</title>
</head>
<body>
<div id="container">
<div id="siteHead">
<h1>nulldesign.study</h1>
<h2>Creative Coding....</h2>
<!--/ siteHead --></div>
<div id="siteBody">
<div id="webglView"><!--/ webglView --></div>
<!--/ siteBody --></div>
<div id="siteFoot"><p>COPYRIGHT &copy; 2018 nulldesign.jp <br>ALL RIGHTS RESERVED.</p>
<!--/ siteFoot --></div>
<!--/ container --></div>


<script type="x-shader/x-fragment" id="computeShaderPosition">
//  現在の位置情報
#define delta 1.0 / 60.0
void main(){
    vec2 uv = gl_FragCoord.xy / resolution.xy;
    vec4 tmpPos = texture2D( texturePosition, uv );
    vec3 pos = tmpPos.xyz;
    vec4 tmpVel = texture2D( textureVelocity, uv );
    vec3 vel = tmpVel.xyz;

    pos += vel * delta;

    gl_FragColor = vec4( pos, 1.0 );
}
</script>

<script type="x-shader/x-fragment" id="computeShaderVelocity">
//  速度情報
#include <common>

//  #define randomX
//  #define randomY
//  #define randomZ

//const float PI = 3.14159265;

uniform float time;

vec2 random2(vec2 st){
       vec2 _st = vec2( dot(st,vec2(127.1,311.7)),
                      dot(st,vec2(269.5,183.3)));
       return -1.0 + 2.0 * fract( sin(_st) * 43758.5453123 );
   }

float perlinNoise(vec2 st)
{
    vec2 p = floor(st);
    vec2 f = fract(st);
    vec2 u = f*f*(3.0-2.0*f);

    vec2 v00 = random2( p + vec2(0,0) );
    vec2 v10 = random2( p + vec2(1,0) );
    vec2 v01 = random2( p + vec2(0,1) );
    vec2 v11 = random2( p + vec2(1,1) );

    return mix( mix( dot( v00, f - vec2(0,0) ), dot( v10, f - vec2(1,0) ), u.x ),
                 mix( dot( v01, f - vec2(0,1) ), dot( v11, f - vec2(1,1) ), u.x ),
                 u.y ) + 0.5;
}

float fBm (vec2 st)
{
    float f = 0.0;
    vec2 q = st;

    f += 0.5000 * perlinNoise( q ); q = q*2.01;
    f += 0.2500 * perlinNoise( q ); q = q*2.02;
    f += 0.1250 * perlinNoise( q ); q = q*2.03;
    f += 0.0625 * perlinNoise( q ); q = q*2.01;

    return f;
}

void main(){
    vec2 uv = gl_FragCoord.xy / resolution.xy;
    //float idParticle = uv.y * resolution.x + uv.x;
    vec4 tmpPos = texture2D( texturePosition, uv );
    vec4 tmpVel = texture2D( textureVelocity, uv );
    vec3 vel = tmpVel.xyz;

    float _timeScale = 0.1;
    float _fieldScale = 0.005;
    float _power = 8.0;

    vel.x = vel.x + ( fBm( tmpPos.yz * _fieldScale + vec2( time * _timeScale, randomX ) ) - 0.5 ) * _power;
    vel.y = vel.y + ( fBm( tmpPos.zx * _fieldScale + vec2( time * _timeScale, randomY ) ) - 0.5 ) * _power;
    vel.z = vel.z + ( fBm( tmpPos.xy * _fieldScale + vec2( time * _timeScale, randomZ ) ) - 0.5 ) * _power;

    float _min = 8.0;
    float _max = 32.0;
    for( float i = 0.0; i < resolution.x; i ++ ){
        for( float j = 0.0; j < resolution.y; j ++ ){
            vec2 _uv = vec2( i, j ) / ( resolution.xy - vec2(1.0,1.0) );
            vec4 _tmpPos = texture2D( texturePosition, _uv );
            vec3 dir = _tmpPos.xyz - tmpPos.xyz;
            float dist = length( dir );

            if (dist < 0.01) continue;

            if( dist < _max )
            {
                if( dist < _min )
                {
                    vel -= dir * ( _min - dist ) / _min * 0.005;
                } else {
                    vel -= dir * ( _max - dist ) / _max * 0.005;
                }
            }
        }
    }

    //  grav
    vel = vel - tmpPos.xyz * 0.0125;
    vel *= 0.98;


    vel = length( vel ) < 16.0? normalize( vel ) * 16.0 : vel;


    gl_FragColor = vec4( vel, 1.0 );
}
</script>


<script type="x-shader/x-vertex" id="boxVertexShader">
#include <common>
uniform float time;
uniform sampler2D texturePosition;
uniform sampler2D textureVelocity;

varying vec3 vPosition;
varying vec3 vNormal;

//const float PI = 3.14159265;

mat2 rotate2d(float _angle){
    return mat2(
        cos(_angle),-sin(_angle),
        sin(_angle),cos(_angle));
}

mat4 rotateX3d( float e ){
    return mat4(
        1,  0,    0,  0,
        0,  cos(e),   -sin(e),   0,
        0,  sin(e),   cos(e),    0,
        0,  0,    0,  1
    );
}

mat4 rotateY3d( float e ){
    return mat4(
        cos(e),  0,    sin(e),  0,
        0,  1,   0,   0,
        -sin(e),  0,   cos(e),    0,
        0,  0,    0,  1
    );
}

mat4 rotateZ3d( float e ){
    return mat4(
        cos(e),  -sin(e),    0,  0,
        sin(e),  cos(e),   0,   0,
        0,  0,  1,    0,
        0,  0,    0,  1
    );
}

mat4 rotate3D( vec3 _r ){
    return rotateX3d( _r.x ) * rotateY3d( _r.y ) * rotateZ3d( _r.z );
}

mat4 translate3d( vec3 _t ){
    return mat4(
            1,0,0,_t.x,
            0,1,0,_t.y,
            0,0,1,_t.z,
            0,0,0,1
        );
}

mat4 scale3d( vec3 _s ){
    return mat4(
            _s.x,0,0,0,
            0,_s.y,0,0,
            0,0,_s.z,0,
            0,0,0,1
        );
}

mat4 translate4D( vec3 _t, vec3 _r, vec3 _s ){
    return translate3d( _t ) * rotate3D( _r ) * scale3d( _s );
}


float atan2(in float y, in float x)
{
    return x == 0.0 ? sign(y)*3.141592653589793/2.0 : atan(y, x);
}

void main()
{
    vPosition = position;
    vNormal = normal;

    vec4 posTemp = texture2D( texturePosition, uv );
    vec3 pos = posTemp.xyz;

    vec4 velTemp = texture2D( textureVelocity, uv );
    vec3 vel = velTemp.xyz;
    vec3 velocity = normalize( vel );

    velocity.z *= -1.;
    float xz = length( velocity.xz );
    float xyz = 1.;
    float x = sqrt( 1. - velocity.y * velocity.y );

    float cosry = velocity.x / xz;
    float sinry = velocity.z / xz;

    float cosrz = x / xyz;
    float sinrz = velocity.y / xyz;

    mat3 maty =  mat3(
        cosry, 0, -sinry,
        0    , 1, 0     ,
        sinry, 0, cosry

    );

    mat3 matz =  mat3(
        cosrz , sinrz, 0,
        -sinrz, cosrz, 0,
        0     , 0    , 1
    );

    vec3 _localPos = maty * matz * ( position * vec3( length(vel) * 0.01,1.0,1.0));
    //vec3 _localPos = maty * matz * position;
    vNormal = maty * matz * normal;

    gl_Position = projectionMatrix * modelViewMatrix * vec4( _localPos + pos, 1.0 );
}
</script>
<script type="x-shader/x-fragment" id="boxFragmentShader">
uniform float time;

uniform vec3 planeColor;
uniform vec3 lightPosition;
uniform vec3 lightColor;
uniform vec3 ambientColor;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vPosition;
varying vec3 vNormal;

#extension GL_OES_standard_derivatives : enable

void main()
{
    //gl_FragColor = vec4(uv,0.5+0.5*sin(time),1.0);

    //vec2 uv = gl_FragCoord.xy / resolution.xy;
    //gl_FragColor = vec4(uv,0.5+0.5*sin(time),1.0);

    vec4 viewLightPosition = viewMatrix * vec4( lightPosition, 0.0 );
    vec3 N = normalize( vNormal );
    vec3 L = normalize( viewLightPosition.xyz );
    float dotNL = dot( N, L );
    vec3 diffuse = planeColor * lightColor * max( dotNL, 0.0 );
    vec3 ambient = planeColor * ambientColor;

    gl_FragColor = vec4( planeColor * vec3( 0.2, 0.6, 0.9 ) * 0.8, 1.0);
    gl_FragColor *= vec4( diffuse + ambient, 1.0 );


    diffuse = vec3( 0.2, 0.6, 0.9 );
    //vec3 light = normalize((gl_LightSource[0].position * position.w - gl_LightSource[0].position.w * position).xyz);
    vec3 light = normalize( lightPosition );
    vec3 position = vPosition;
    vec3 fnormal = normalize(vNormal);

    vec3 dx = dFdx(position.xyz);
    vec3 dy = dFdy(position.xyz);
    fnormal = normalize(cross(normalize(dx), normalize(dy)));

    float _diffuse = max(dot(light, fnormal), 0.0);
    vec3 view = - normalize(position.xyz);
    vec3 halfway = normalize(light + view);
    float _specular = pow(max(dot(fnormal, halfway), 0.0), 4.0 );

    gl_FragColor = vec4( diffuse * _diffuse + vec3( 1.0, 1.0, 1.0 ) * _specular + ambient, 1.0 );





    //  FOG
    #ifdef USE_FOG
        #ifdef USE_LOGDEPTHBUF_EXT
            float depth = gl_FragDepthEXT / gl_FragCoord.w;
        #else
            float depth = gl_FragCoord.z / gl_FragCoord.w;
        #endif
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
    #endif
}
</script>



<script type="text/javascript" src="shared/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="shared/js/three.min.js"></script>
<script type="text/javascript" src="shared/js/GPUComputationRenderer.js"></script>
<script type="text/javascript" src="shared/js/OrbitControls.js"></script>
<script type="text/javascript" src="shared/js/world.js"></script>
<script type="text/javascript" src="shared/js/CopyShader.js"></script>
<script type="text/javascript" src="shared/js/EffectComposer.js"></script>
<script type="text/javascript" src="shared/js/MaskPass.js"></script>
<script type="text/javascript" src="shared/js/RenderPass.js"></script>
<script type="text/javascript" src="shared/js/ShaderPass.js"></script>

<script type="text/javascript" src="shared/js/NoiseShader.js"></script>
<script type="text/javascript" src="shared/js/VignetteShader.js"></script>
<script type="text/javascript" src="shared/js/InvertShader.js"></script>
<script type="text/javascript" src="shared/js/LineShader.js"></script>
<script type="text/javascript" src="shared/js/RGBNoiseShader.js"></script>
<script type="text/javascript" src="shared/js/MonoShader.js"></script>
<script type="text/javascript" src="shared/js/BlurShader.js"></script>
<script type="text/javascript" src="shared/js/BackBufferShader.js"></script>

<script type="text/javascript" src="shared/js/ConvolutionShader.js"></script>
<script type="text/javascript" src="shared/js/BloomPass.js"></script>
<script type="text/javascript" src="shared/js/engine.js"></script>
</body>
</html>
