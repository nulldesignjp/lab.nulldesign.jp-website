(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{254:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var o,n=r(110),v=r(111),l=(r(112),r(165),r(37),r(223)),c=function(){function e(t){Object(n.a)(this,e),o=this,this.param=t,this.textures=[(new l.L).load("/assets/img/spark1.png"),(new l.L).load("/assets/img/circle1.png")],this.init()}return Object(v.a)(e,[{key:"init",value:function(){this.distance=200,this.fireHeight=100,this.particles=[],this.fireworks=[];var e=new l.Geometry;e.vertices[0]=new l.O(-50,0,0),e.vertices[1]=new l.O(50,0,0);var t=new l.r({transparent:!0,opacity:.2}),r=new l.q(e,t);this.world.add(r),r.position.z=-this.distance}},{key:"update",value:function(){o.updateFireWorks(),o.updateParticles()}},{key:"addFire",value:function(e){o.createFireWorks(e)}},{key:"removeFire",value:function(){}},{key:"createFireWorks",value:function(e){console.log("createFireWorks",e);var t=~~((e.fworkHueMax-e.fworkHueMin)*Math.random())+e.fworkHueMin;t/=360;for(var r=new l.d,n=[],v=[],c=[],m=[],f=new l.h,d=64,i=0;i<d;i++)n.push(0),n.push(0),n.push(0),f.setHSL(t,1,.5),v.push(f.r,f.g,f.b),c.push(i/d*i/d*i/d*i/d*i/d*3),m.push(d-i);r.setAttribute("position",new l.m(n,3)),r.setAttribute("colors",new l.m(v,3)),r.setAttribute("size",new l.m(c,1).setUsage(l.k)),r.setAttribute("idx",new l.m(m,1).setUsage(l.k));var h=new l.I({uniforms:{time:{value:0},texture:{value:o.textures[1]}},vertexShader:["uniform float time;","attribute float size;","attribute float idx;","attribute vec3 colors;","varying float vIdx;","varying float rand;","varying vec3 vColors;","highp float random(vec2 co){","    highp float a = 12.9898;","    highp float b = 78.233;","    highp float c = 43758.5453;","    highp float dt= dot(co.xy ,vec2(a,b));","    highp float sn= mod(dt,3.14);","    return fract(sin(sn) * c);","}","","float noise2(vec2 st)","{","    vec2 p = floor(st);","    return random(p);","}","","float noise3(vec2 st)","{","    vec2 p = floor(st);","    return random(p + vec2(time,0.0));","}","","float valueNoise(vec2 st)","{","    vec2 p = floor(st);","    vec2 f = fract(st);","","    float v00 = random( p + vec2( 0, 0 ) );","    float v10 = random( p + vec2( 1, 0 ) );","    float v01 = random( p + vec2( 0, 1 ) );","    float v11 = random( p + vec2( 1, 1 ) );","","    vec2 u = f * f * (3.0 - 2.0 * f);","","    float v0010 = mix(v00, v10, u.x);","    float v0111 = mix(v01, v11, u.x);","    return mix(v0010, v0111, u.y);","}","","vec2 random2(vec2 st){","       vec2 _st = vec2( dot(st,vec2(127.1,311.7)),","                      dot(st,vec2(269.5,183.3)));","       return -1.0 + 2.0 * fract( sin(_st) * 43758.5453123 );","   }","","float perlinNoise(vec2 st)","{","    vec2 p = floor(st);","    vec2 f = fract(st);","    vec2 u = f*f*(3.0-2.0*f);","","    vec2 v00 = random2( p + vec2(0,0) );","    vec2 v10 = random2( p + vec2(1,0) );","    vec2 v01 = random2( p + vec2(0,1) );","    vec2 v11 = random2( p + vec2(1,1) );","","    return mix( mix( dot( v00, f - vec2(0,0) ), dot( v10, f - vec2(1,0) ), u.x ),","                 mix( dot( v01, f - vec2(0,1) ), dot( v11, f - vec2(1,1) ), u.x ),","                 u.y ) + 0.5;","}","","float fBm (vec2 st)","{","    float f = 0.0;","    vec2 q = st;","","    f += 0.5000 * perlinNoise( q ); q = q*2.01;","    f += 0.2500 * perlinNoise( q ); q = q*2.02;","    f += 0.1250 * perlinNoise( q ); q = q*2.03;","    f += 0.0625 * perlinNoise( q ); q = q*2.01;","","    return f;","}","void main() {","\tvec3 pos = position;","\tpos.y +=  - idx * 0.6;","\tpos.x += ( perlinNoise( pos.yz * 2.1 + vec2(time,time) ) - 0.5 ) * 0.75;","\tpos.z += ( perlinNoise( pos.xy * 2.1 - vec2( -time, -time ) ) - 0.5 ) * 0.75;","\tvIdx = 1.0 - idx / 64.0;","\trand = perlinNoise( pos.yz * 12.1 + vec2( time, 0.0 ) ) * 0.5 + 0.5;","\tvColors = colors;","\tvec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","   gl_PointSize = size * (800.0 / length(mvPosition.xyz));","gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform sampler2D texture;","varying float vIdx;","varying float rand;","varying vec3 vColors;","void main( void ) {","\tvec4 tex = texture2D( texture, gl_PointCoord );","\tgl_FragColor = tex * vec4( vColors, 1.0 );","\tgl_FragColor.a *= vIdx * vIdx * vIdx * rand;","}"].join("\n"),blending:l.b,depthTest:!1,transparent:!0,vertexColors:!0}),w=new l.C(r,h);o.world.add(w),w.position.x=e.position.x,w.position.y=e.position.y,w.position.z=e.position.z,e.start=new l.O,e.end=new l.O(0,o.fireHeight,0);var x={};x.mesh=w,x.param=e,o.fireworks.push(x)}},{key:"updateFireWorks",value:function(){for(var e=this.fireworks.length;e;){e--;var t=this.fireworks[e].mesh,r=this.fireworks[e].param;t.material.uniforms.time.value+=1/60,t.position.y+=r.fworkSpeed,t.position.y>o.fireHeight&&(r.start=t.position.clone(),o.world.remove(t),r.mesh=null,o.createParticles(r),o.fireworks.splice(e,1),t.geometry.dispose(),null!=t.material.map&&t.material.uniforms.map.dispose(),t.material.dispose(),t.geometry=null,t.material=null,t=null)}}},{key:"createParticles",value:function(e){console.log("createParticles",e);var t=~~((e.partHueMax-e.partHueMin)*Math.random())+e.partHueMin;t/=360;for(var r=e.partCount,n=new l.Geometry,i=0;i<r;i++){var v=5*(1-Math.random()*Math.random()),c=Math.acos(2*i/r-1),m=Math.sqrt(r*Math.PI)*c;n.vertices[i]=new l.O,n.vertices[i].setFromSphericalCoords(v,c,m).multiplyScalar(2)}n.rotateX(Math.random()*Math.PI*2),n.rotateY(Math.random()*Math.PI*2),n.rotateZ(Math.random()*Math.PI*2);var f=new l.D({transparent:!0,opacity:1,map:o.textures[0],blending:l.b,depthTest:!1,size:e.partSize,color:(new l.h).setHSL(t,.96,.6+.25*Math.random())}),d=new l.C(n,f);o.world.add(d),d.position.x=e.start.x,d.position.y=e.start.y,d.position.z=e.start.z;var h={};h.mesh=d,h.param=e,o.particles.push(h)}},{key:"updateParticles",value:function(){for(var e=this.particles.length;e;){e--;var t=this.particles[e].mesh,r=this.particles[e].param;r.lifeTime-=1/60,t.material.size=o.easeInExpo(1-r.lifeTime/r.lifeTimeMaster,r.partSize,-r.partSize,1);for(var n=t.geometry.vertices.length;n;){n--;var v=t.geometry.vertices[n].clone();v.normalize();var l=r.lifeTime/r.lifeTimeMaster;t.geometry.vertices[n].add(v.multiplyScalar(l*l*l*r.partSpeed));var c=1-l;t.geometry.vertices[n].y-=.5*r.partGravity*c*c}t.geometry.verticesNeedUpdate=!0,r.lifeTime<0&&(o.world.remove(t),r.mesh=null,o.particles.splice(e,1))}}},{key:"dispose",value:function(){}},{key:"easeInExpo",value:function(e,b,t,r){return 0==e?b:t*Math.pow(2,10*(e/r-1))+b-.001*t}}]),e}()}}]);