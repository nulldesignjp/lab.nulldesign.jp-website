<!doctype>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes">
<meta name="keywords" content="sandbox">
<meta name="description" content="">
<title>webgl sample</title>
<style>
html,body{height:100%;overflow:hidden;}
body{margin:0;padding:0;background:#000;color:#FFF;font-size:12px;font-family:Georgia;}
#container{width:100%;height:100%;}
canvas{position:fixed;left:0;top:0;}
h1,p{margin:0;padding:0;line-height:1;position:fixed;z-index:100;font-size:1em;}
h1{left:16px;top:64px;font-weight:normal;}
p{left:16px;bottom:32px;}
</style>
</head>
<body>
<h1>150416_03</h1>
<div id="container"></div>
<script src="../js/jquery-2.1.3.min.js"></script>
<script src="../js/Detector.js"></script>
<script src="../js/perlin-noise-simplex.js"></script>
<script src="../js/r71/three.min.js"></script>
<script src="../js/stats.min.js"></script>
<script src="../js/THREE.ConvexGeometry.js"></script>
<script src="world3d.js"></script>

<script type="x-shader/x-vertex" id="vertexshader">
uniform float time;
uniform vec2 mouse;
//
//varying vec3 vUv;
void main()
{
	//vUv = position;
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    //gl_PointSize = 1.0;
}
</script>
<script type="x-shader/x-fragment" id="fragmentshader">
uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;

//
//varying vec3 vUv;

const float PI   = 3.1415926;

//  circle(謎, 中心点, 半径)
float circle(vec2 p, vec2 center, float r)
{
    float d = distance(p, center);
    return 2.0 * r / d;
}

void main()
{
    //  mod ... あまりを求める%的なアレ

    vec2 position = ( gl_FragCoord.xy / resolution.xy );    //  0-1
    //vec2 position = ( vUv.xy / resolution.xy );
    position = 2.0 * position - 1.0;    //  -1 - 1
    position.x *= resolution.x / resolution.y;

    float interval = 10.0;
    float t = mod(time*0.1, interval) / interval;
    float x = t * 2.0 - 1.0;
    float y = sin(t * PI * 5.0);
    float color = 0.0;
    float ca = circle(position, vec2(x, y), 0.2);
    
    interval = 2.0;
    t = mod(time*0.1, interval) / interval;
    x = t * 2.0 - 1.0;
    y = 0.0;
    float cb = circle(position, vec2(-x, y), 0.3);
    
    interval = 10.0;
    t = mod(time*0.1, interval) / interval;
    x = 0.5 * cos( PI * 2.0 * t);
    y = 0.5 * sin( PI * 2.0 * t);
    float cc = circle(position, vec2(-x, y), 0.3);
    
    color = ca * cb * cc;
    
    gl_FragColor = vec4( color * 0.5, color * sin(time*0.1), color, 1.0 );

}
</script>

<script type="text/javascript">
//	http://glslsandbox.com/e#24490.5
(function(){

	//	stats
	var stats;
	createStats();

	//	perlinNoise
	var _perlinNoise = new SimplexNoise();
	var _value = _perlinNoise.noise( 0, 0 );

	//	uniforms
	var uniforms = {
		volume: { type: "f", value: 0.0 },
		time: { type: "f", value: 1.0 },
		resolution: { type: "v2", value: new THREE.Vector2() },
		mouse: { type: "v2", value: new THREE.Vector2() }
	};
	uniforms.time.value = 0.0;
	uniforms.resolution.value.x = window.innerWidth;
	uniforms.resolution.value.y = window.innerHeight;
	uniforms.mouse.value.x = 0;
	uniforms.mouse.value.y = 0;
	uniforms.volume.value = 0.0;

	var attributes = {
		vertices: { type:'v3',  value: [] }
	}

	var _vertexShader = document.getElementById('vertexshader').textContent;
	var _fragmentShader = document.getElementById('fragmentshader').textContent;
	var _world = new world3d.three( document.getElementById('container') );
	var _group = new THREE.Group();
	_world.scene.add( _group );

	var geometry = new THREE.PlaneGeometry( 500, 500, 5, 5 );
	attributes.vertices.value = geometry.vertices;
	var material = new THREE.ShaderMaterial({
		uniforms: uniforms,
		attributes: attributes,
		vertexShader: _vertexShader,
		fragmentShader: _fragmentShader
	});

    var _mesh = new THREE.Mesh( geometry, material );
    _group.add( _mesh );

    window.addEventListener('mousemove', function (e) {
        world3d.mouse.x = e.pageX;
        world3d.mouse.y = e.pageY;
        uniforms.mouse.value.x = world3d.mouse.x / window.innerWidth;
        uniforms.mouse.value.y = (window.innerHeight - world3d.mouse.y) / window.innerHeight;
        e.preventDefault();
    }, false);
    window.addEventListener('touchmove', function (e) {
        world3d.mouse.x = e.touches[0].pageX;
        world3d.mouse.y = e.touches[0].pageY;
        uniforms.mouse.value.x = world3d.mouse.x / window.innerWidth;
        uniforms.mouse.value.y = (window.innerHeight - world3d.mouse.y) / window.innerHeight;
        e.preventDefault();
    }, false);


	_world.engine = function(){
		stats.update();
	}

	setInterval(function(){
		uniforms.time.value += 0.05;
	},1000/60);


	function createStats()
	{
		stats = new Stats();
		stats.domElement.style.position = 'fixed';
		stats.domElement.style.left = "0px";
		stats.domElement.style.top = '0px';
		stats.domElement.style.zIndex = '100';
		document.getElementById('container').appendChild( stats.domElement );
	}
})();
</script>
</body>
</html>