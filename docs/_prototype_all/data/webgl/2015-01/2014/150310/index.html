<!doctype>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes">
<meta name="keywords" content="">
<meta name="description" content="CLASS">
<title>webgl sample</title>
<style>
html,body{height:100%;overflow:hidden;}
body{
	margin: 0;
	padding: 0;
	background: #000;
}
#container{
	width: 100%;
	height: 100%;
}
</style>
</head>
<body>
<div id="container"></div>
<script src="../js/jquery-2.1.1.min.js"></script>
<script src="../js/Detector.js"></script>
<script src="../js/three.min.js"></script>
<script src="world3d.js"></script>
<script type="x-shader/x-vertex" id="vertexshader">
uniform float amplitude;
uniform float scale;
attribute float size;
attribute vec3 customColor;
varying vec3 vColor;
void main()
{
	vColor = customColor;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_PointSize = size * scale;
	//gl_PointSize = size * ( 300.0 / length( mvPosition.xyz ) ) * scale * 10.0;
	gl_Position = projectionMatrix * mvPosition;
}
</script>
<script type="x-shader/x-fragment" id="fragmentshader">
uniform vec3 color;
uniform sampler2D texture;
void main()
{
	gl_FragColor = vec4( color * vColor, 1.0 );
	//gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );
}
</script>
<script type="text/javascript">
(function(){

	var _clist = [];

	var _dom = document.getElementById('container');
	var _t = new world3d.three( _dom );

	_t.camera.position.set( 0, 1500, 0 )

	var _geometry = new THREE.PlaneGeometry( 500, 500, 10, 10 );
	var _material = new THREE.MeshPhongMaterial({transparent:true,opacity:0.4});
	var _mesh = new THREE.Mesh( _geometry, _material );
	_t.scene.add( _mesh );
	_mesh.rotation.x = - Math.PI * 0.5;
	_mesh.position.set( 0, -250, 0 );

	var _geometry = new THREE.PlaneGeometry( 500, 500, 10, 10 );
	var _material = new THREE.MeshPhongMaterial({transparent:true,opacity:0.4});
	var _mesh = new THREE.Mesh( _geometry, _material );
	_t.scene.add( _mesh );
	_mesh.rotation.x = Math.PI * 0.5;
	_mesh.position.set( 0, 250, 0 );

	var _p = new THREE.PointLight( 0x99ccff, 1, 1000 );
	_p.position.set( 0, 0, 0 );
	_t.scene.add( _p );


	var len = 64;
	var leng = 32;
	var _speed = 16;
	for( var i = 0; i < len; i++ )
	{
		var _p = new THREE.PointLight( 0x006699, 4, 100 );
		_t.scene.add( _p );

		var _geometry = new THREE.Geometry();
		_geometry.verticesNeedUpdate = true;
		_geometry.dynamic = true;

		for( var j = 0; j < leng; j++ )
		{
			_geometry.vertices[j] = new THREE.Vector3( 0,0,0 );
		}
		var _material = new THREE.LineBasicMaterial({linewidth:1,color: 0x99CCFF});
		var _mesh = new THREE.Line( _geometry, _material );
		_t.scene.add( _mesh );

		var _vx = Math.random() * 1 - 0.5;
		var _vy = Math.random() * 1 - 0.5;
		var _vz = Math.random() * 1 - 0.5;
		_vx *= _speed;
		_vy *= _speed;
		_vz *= _speed;

		_clist.push({
			geometry:_geometry,
			light: _p,
			vx: _vx,
			vy: _vy,
			vz: _vz
		});
	}

	setInterval(function(){

		//	CAMERA
		var _rad = world3d.time * 0.0001;
		var _x = Math.cos( _rad ) * 1200;
		var _z = Math.sin( _rad ) * 1200;
		_t.camera.position.set( _x, 0, _z );

		//	LINE
		var len = _clist.length;
		while( len )
		{
			len--;
			var _obj = _clist[len];
			var _vertices = _obj.geometry.vertices;
			var _px = _vertices[0].x;
			var _py = _vertices[0].y;
			var _pz = _vertices[0].z;

			var len0 = _vertices.length;
			for( var i = 0; i < len0; i++ )
			{
				var __px = _vertices[i].x;
				var __py = _vertices[i].y;
				var __pz = _vertices[i].z;

				_vertices[i].x = _px;
				_vertices[i].y = _py;
				_vertices[i].z = _pz;

				_px = __px;
				_py = __py;
				_pz = __pz;
			}
			_vertices[0].x += _obj.vx;
			_vertices[0].y += _obj.vy;
			_vertices[0].z += _obj.vz;

			if( _vertices[0].x < -250 )
			{
				_vertices[0].x = -250;
				_obj.vx *= -1;

			} else if( _vertices[0].x > 250 )
			{
				_vertices[0].x = 250;
				_obj.vx *= -1;
			}
			if( _vertices[0].y < -250 )
			{
				_vertices[0].y = -250;
				_obj.vy *= -1;
			} else if( _vertices[0].y > 250 )
			{
				_vertices[0].y = 250;
				_obj.vy *= -1;
			}
			if( _vertices[0].z < -250 )
			{
				_vertices[0].z = -250;
				_obj.vz *= -1;
			} else if( _vertices[0].z > 250 )
			{
				_vertices[0].z = 250;
				_obj.vz *= -1;
			}
			_obj.geometry.verticesNeedUpdate = true;

			_obj.light.position.x = _vertices[0].x;
			_obj.light.position.y = _vertices[0].y;
			_obj.light.position.z = _vertices[0].z;
		}
	},1000/60);

})();
</script>
</body>
</html>