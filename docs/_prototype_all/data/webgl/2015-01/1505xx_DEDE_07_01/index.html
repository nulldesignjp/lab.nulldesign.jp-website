<!doctype>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes">
<meta name="keywords" content="">
<meta name="description" content="CLASS">
<title>DE DE MOUSE + HACKist</title>
<style>
html,body{height:100%;overflow:hidden;}
body{
	margin: 0;
	padding: 0;
	background: #000;
	color: #FFF;
	font-size: 12px;
	font-family: Arial;
}
#container{
	width: 100%;
	height: 100%;
}

h1,p{
	margin: 0;
	padding: 0;
	line-height: 1;
	position: fixed;
	z-index: 100;
	font-size: 1em;
}
h1{
	left: 32px;
	top: 32px;
}
p{
	left: 32px;
	bottom: 32px;
}
</style>
</head>
<body>
<h1>千本桜 - 静</h1>
<div id="container"></div>
<script src="../js/jquery-2.1.3.min.js"></script>
<script src="../js/Detector.js"></script>
<script src="../js/perlin-noise-simplex.js"></script>
<script src="../js/r71/three.min.js"></script>
<script src="../js/stats.min.js"></script>
<script src="../js/THREE.ConvexGeometry.js"></script>
<script src="world3d.js"></script>
<script type="text/javascript">

    var _scale = screen.width / ( 1280 * 3 );
    var _top = Math.floor( ( screen.height - 1024 * _scale ) * 0.5 );
    window.moveTo( 0, _top );
    window.resizeTo( 1280 * 3  * _scale, 1024 * _scale );

(function(){
	var _tr = 0x66 / 0xFF;
	var _tg = 0x99 / 0xFF;
	var _tb = 0xCC / 0xFF;
	var __r = _tr;
	var __g = _tg;
	var __b = _tb;
	var _size = 3840 * 0.5;
	var _hsize = 1024 * 0.5;
	var lineNums = 1024 * 64;
	var _initSpeed = 2.0;
	var _speed = 0.36;
	var _scale = 1.6;

	_scale =1.6;
	var _frection = 0.98;
	var _is3d = true;
	var _changeDuration = 15.0;
	var simplexNoiseX = new SimplexNoise();
	var simplexNoiseY = new SimplexNoise();
	var simplexNoiseZ = new SimplexNoise();
	var _cube;
	var _lineMaterial;
	var _lineList = [];
	var _particle;
	var _wheelValue = 1200;
	var _particleAccell = 0.01;

	var _wind = 0;

	//	threejs
	var _dom = document.getElementById('container');
	var _t = new world3d.three( _dom );
	_t.camera.position.set( 0, 0, 600 );

	//
	_cube = new THREE.Object3D();
	_t.scene.add( _cube );

	//	init lines

	_tr = Math.random();
	_tg = Math.random();
	_tb = Math.random();
	__r = _tr;
	__g = _tg;
	__b = _tb;

	init();
	start();

	//	
	$( window ).on( 'click', function(e){
		_break();
	})



	//document.getElementById("container").style.webkitFilter = "blur(2px)";

	//	FUNCTION
	function init()
	{
		var _material = new THREE.PointCloudMaterial({
			size: 5,
			color: new THREE.Color(__r,__g,__b),
			transparent:true,
			opacity:0.8,
			blending:       THREE.AdditiveBlending
		});

		_lineMaterial = _material;

		var _geometry = new THREE.Geometry();
		for( var i = 0; i < lineNums; i++ )
		{
			_geometry.vertices[i] = new THREE.Vector3( (Math.random()-.5)*_size*2,(Math.random()-.5)*_size*2,0 );
			var _vx = (Math.random()-.5)*1.0;
			var _vy = (Math.random()-.5)*1.0;
			var _vz = (Math.random()-.5)*1.0;
			_vx *= _initSpeed;
			_vy *= _initSpeed;
			_vz *= _initSpeed;

			_vz = 0;

			_lineList.push({
				vertices:_geometry.vertices[i],
				vx: _vx,
				vy: _vy,
				vz: _vz
			});
		}

		_particle = new THREE.PointCloud( _geometry, _material );
		_cube.add( _particle );

	}

	function _break()
	{
		if( Math.random() > .5 )
		{
			simplexNoiseX = new SimplexNoise();
			simplexNoiseY = new SimplexNoise();

			_scale = Math.random() * 0.5 + 1.4;
		}

		//	乱回転
		var len = _lineList.length;
		while( len )
		{
			len--;
			var _obj = _lineList[len];
			var _rad = Math.random() * Math.PI * 2;
			var _pow = ( 1 - Math.random() * Math.random() ) * 8.0;
			_obj.vx += Math.cos( _rad ) * _pow;
			_obj.vy += Math.sin( _rad ) * _pow;
		}

		_tr = Math.floor( Math.random() * 0xCC + 0x33 ) / 0xFF;
		_tg = Math.floor( Math.random() * 0xCC + 0x33 ) / 0xFF;
		_tb = Math.floor( Math.random() * 0xCC + 0x33 ) / 0xFF;

		_particleAccell = Math.random() * 0.01 + 0.01;

	}

	function start()
	{
		setInterval(function(){
			_break();
		},1000 * _changeDuration);
		setInterval(function(){

			_wheelValue = Math.sin( Date.now() * 0.0001 ) * 200 + 400;

			_wind += ( 0 - _wind ) * 0.1;

			__r += ( _tr - __r ) * 0.01;
			__g += ( _tg - __g ) * 0.01;
			__b += ( _tb - __b ) * 0.01;

			_lineMaterial.color = new THREE.Color( __r,__g,__b );

			//	LINE
			var _time = Date.now() * 0.02;
			var len = _lineList.length;
			while( len )
			{
				len--;
				var _obj = _lineList[len];
				var _vertices = _obj.vertices;
				var _px = _vertices.x;
				var _py = _vertices.y;

				_vertices.x += _obj.vx;
				_vertices.y += _obj.vy;

				_obj.vx += simplexNoiseX.noise( ( _vertices.x + _size * 2 + _time ) / ( _size * 2.0 ) * _scale * 15/4 + _time*0.005 + _wind, ( _vertices.y + _hsize * 2 + _time ) / ( _hsize * 2.0 ) * _scale ) * _speed;
				_obj.vy += simplexNoiseY.noise( ( _vertices.y + _size * 2 + _time ) / ( _size * 2.0 ) * _scale * 15/4 + _time*0.005, ( _vertices.x + _hsize * 2 + _time ) / ( _hsize * 2.0 ) * _scale ) * _speed;

				_obj.vx += (Math.random()-.5)*.1;
				_obj.vy += (Math.random()-.5)*.1;

				//	air frection
				_obj.vx *= _frection;
				_obj.vy *= _frection;

				//
				if( _vertices.x < -_size )
				{
					//_vertices.x = -_hsize;
					_obj.vx *= Math.random() * .2 + .9;
					_vertices.x += _size * 2;

				} else if( _vertices.x > _size )
				{
					//_vertices.x = _hsize;
					_obj.vx *= Math.random() * .2 + .9;
					_vertices.x -= _size * 2;
				}
				if( _vertices.y < - _hsize )
				{
					//_vertices.y = -_hsize;
					_obj.vy *= Math.random() * .2 + .9;
					_vertices.y += _hsize * 2;
				} else if( _vertices.y > _hsize )
				{
					//_vertices.y = _hsize;
					_obj.vy *= Math.random() * .2 + .9;
					_vertices.y -= _hsize * 2;
				}
			}

			_particle.geometry.verticesNeedUpdate = true;
		},1000/60);
	}

})();
</script>
</body>
</html>