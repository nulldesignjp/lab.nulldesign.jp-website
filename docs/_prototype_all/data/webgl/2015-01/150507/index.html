<!doctype>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes">
<meta name="keywords" content="blender, practice">
<meta name="description" content="">
<title>webgl sample</title>
<style>
html,body{height:100%;overflow:hidden;}
body{margin:0;padding:0;background:#000;color:#FFF;font-size:12px;font-family:Georgia;}
#container{width:100%;height:100%;}
canvas{position:fixed;left:0;top:0;}
h1,p{margin:0;padding:0;line-height:1;position:fixed;z-index:100;font-size:1em;}
h1{left:16px;top:64px;font-weight:normal;}
p{left:16px;bottom:32px;}
</style>
</head>
<body>
<h1>150507</h1>
<div id="container"></div>
<script src="../js/jquery-2.1.3.min.js"></script>
<script src="../js/Detector.js"></script>
<script src="../js/perlin-noise-simplex.js"></script>
<script src="../js/r71/three.min.js"></script>
<script src="../js/stats.min.js"></script>
<script src="../js/THREE.ConvexGeometry.js"></script>
<script src="world3d.js"></script>

<script type="text/javascript">
(function(){

	//	stats
	var stats;
	createStats();

	//	perlinNoise
	var _perlinNoise = new SimplexNoise();
	var _value = _perlinNoise.noise( 0, 0 );

	var _world = new world3d.three( document.getElementById('container') );
	var _group = new THREE.Group();
	_world.scene.add( _group );

	var _l0 = new THREE.AmbientLight( 0x181818 );
	_world.scene.add( _l0 );

	var _l1 = new THREE.DirectionalLight( 0xCCCCCC, 1.0 );
	_l1.position.set( 1, 1, 1 );
	_world.scene.add( _l1 );

	var _l2 = new THREE.SpotLight( 0xCCCCCC );
	_l2.position.set( 100, 1000, 100 );
	// spotLight.castShadow = true;

	// spotLight.shadowMapWidth = 1024;
	// spotLight.shadowMapHeight = 1024;

	// spotLight.shadowCameraNear = 500;
	// spotLight.shadowCameraFar = 4000;
	// spotLight.shadowCameraFov = 30;
	_world.scene.add( _l2 );

    //	http://www.atmarkit.co.jp/ait/articles/1210/04/news142_2.html
	var mesh   = new THREE.Object3D(); // 読み込みが完了するまでのダミー
	var material = new THREE.MeshLambertMaterial({shading: THREE.FlatShading,color:0x666666});
	var loader = new THREE.JSONLoader();
	loader.load( 'untitled.json', function ( geometry, materials ) {
		var material = new THREE.MeshFaceMaterial( materials );
		console.log( geometry, materials );
		mesh = new THREE.Mesh( geometry, material );
		mesh.scale.x = mesh.scale.y = mesh.scale.z = 60;

		//	共通設定があればここで
		var len = materials.length;
		for( var i = 0; i < len; i++ )
		{
			var _material = materials[i];
			_material.shading = THREE.FlatShading;
			//_material.wireframe = true;
			_material.side = THREE.DoubleSide;
		}

		_group.add( mesh );


		for( var i in mesh.geometry.vertices )
		{
			//mesh.geometry.vertices[i].y = ( Math.random()-.5 ) * 0.5;

			//mesh.geometry.vertices[i].x += i;
			//mesh.geometry.vertices[i].z *= 1/Math.sqrt(3);
		}

		mesh.geometry.verticesNeedUpdate = true;


		$( window ).on( 'click', function(e){
			var len = materials.length;
			for( var i = 0; i < len; i++ )
			{
				var _material = materials[i];
				_material.wireframe = !_material.wireframe;
			}
		})
	} );

	//	floating stone	
	for( var i = 0; i < 24; i++ )
	{
		var vertices = [];
		for( var j = 0; j < 32; j++ )
		{
			vertices.push( new THREE.Vector3(Math.random()*60-30,Math.random()*60-30,Math.random()*60-30))
		}
		var geometry = new THREE.ConvexGeometry( vertices )
		var _mesh = new THREE.Mesh( geometry, material );
		_mesh.position.x = Math.random() * 1000 - 500;
		_mesh.position.y = Math.random() * 1000 - 500;
		_mesh.position.z = Math.random() * 1000 - 500;
		_group.add( _mesh );
	}

	_world.engine = function(){
		stats.update();

		mesh.rotation.x = Math.PI * 0.5;

		//
		_world.camera.position.x = Math.sin( Date.now() * 0.0001 ) * 400;
	}

	function createStats()
	{
		stats = new Stats();
		stats.domElement.style.position = 'fixed';
		stats.domElement.style.left = "3px";
		stats.domElement.style.top = '3px';
		stats.domElement.style.zIndex = '100';
		document.getElementById('container').appendChild( stats.domElement );
	}
})();
</script>
</body>
</html>