<!doctype>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes">
<meta name="keywords" content="">
<meta name="description" content="CLASS">
<title>DE DE MOUSE + HACKist</title>
<style>
html,body{height:100%;overflow:hidden;}
body{
	margin: 0;
	padding: 0;
	background: #000;
	color: #FFF;
	font-size: 12px;
	font-family: Arial;
}
#container{
	width: 100%;
	height: 100%;
}

h1,p{
	margin: 0;
	padding: 0;
	line-height: 1;
	position: fixed;
	z-index: 100;
	font-size: 1em;
}
h1{
	left: 32px;
	top: 32px;
}
p{
	left: 32px;
	bottom: 32px;
}
</style>
</head>
<body>
<h1>frame</h1>
<div id="container"></div>
<script src="../js/jquery-2.1.3.min.js"></script>
<script src="../js/Detector.js"></script>
<script src="../js/perlin-noise-simplex.js"></script>
<script src="../js/r71/three.min.js"></script>
<script src="../js/stats.min.js"></script>
<script src="../js/THREE.ConvexGeometry.js"></script>
<script src="world3d.js"></script>

<script type="x-shader/x-vertex" id="vertexshader">
void main()
{
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
</script>
<script type="x-shader/x-fragment" id="fragmentshader">

    

//---------------------------------------------------------
// Shader:   SuperNovaeFusion.glsl            by   I.G.P
// original: https://www.shadertoy.com/view/4tfGRr
// use mouse to rotate and look around
//---------------------------------------------------------
#ifdef GL_ES
  precision highp float;
#endif

uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;

//---------------------------------------------------------
vec2 cmul( vec2 a, vec2 b )  
{ 
    return vec2( a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x );
}

vec3 dmul( vec3 a, vec3 b )  
{
    float r = length(a);   
    b.xy = cmul(normalize(a.xy), b.xy);
    b.yz = cmul(normalize(a.yz), b.yz);
    b.xz += 0.3 * cmul(normalize(a.xz), b.xz);
    return r*b;
}

float field(in vec3 p) 
{
    float res = 0.0;
    vec3 c = p;
    for (int i = 0; i < 10; ++i) 
    {
        p = abs(p) / dot(p,p) - 1.0;
        p = dmul(p,p) + 0.7;
        res += exp(-6.0 * abs(dot(p,c)-0.15));
    }
    return max(0.0, res / 3.0);
}

vec3 raycast( in vec3 ro, vec3 rd )
{
    float t = 1.5;
    float dt = 0.25;
    vec3 col = vec3(0.0);
    for( int i=20; i<25; i++ )
    {
        float c = field(ro+t*rd);               
        t+=dt / (0.35+c*c);
        c = max(5.0 * c - .9, 0.0);
        c = c*c*c*c;
        col = 0.04*col + 0.04*vec3(0.1*c*c, 0.2*c, 0.0);
    }
    return col;
}

void main(void)
{
    vec2 surfacePosition = gl_FragCoord.xy / resolution.xy;
    
    vec2 q = gl_FragCoord.xy / resolution.xy;
    vec2 p = -1.0 + 2.0 * q;
    p.x *= resolution.x / resolution.y;
    p += surfacePosition - 0.5;

    // camera
    float angle = 0.05*time + 3.14 * mouse.x;
    vec3 ro = vec3(3.2*cos(angle) + 0.5, 0.0 , 3.2*sin(angle) +0.5);
    vec3 ta = vec3(0.0, 1.2 - 2.0*mouse.y, 0.0);
    vec3 ww = normalize (ta - ro );
    vec3 uu = normalize (cross (ww, vec3(0.0, 1.0, 0.0)));
    vec3 vv = normalize (cross (uu, ww));
    vec3 rd = normalize (p.x*uu + p.y*vv + 4.0*ww);
    
    // raymarch
    vec3 col = raycast(ro, rd);
    
    // shade
    col =  0.3 *(log(1.0+0.2*col));
    gl_FragColor = vec4(sqrt(col), 1.0);
}

</script>

<script type="text/javascript">

// var _scale = screen.width / ( 1280 * 3 );
// var _top = Math.floor( ( screen.height - 1024 * _scale ) * 0.5 );
// window.moveTo( 0, _top );
// window.resizeTo( 1280 * 3  * _scale, 1024 * _scale );

(function(){

    var uniforms = {
        volume: { type: "f", value: 0.0 },
        time: { type: "f", value: 1.0 },
        resolution: { type: "v2", value: new THREE.Vector2() },
        mouse: { type: "v2", value: new THREE.Vector2() }
    };
    uniforms.time.value = 0.0;
    uniforms.resolution.value.x = window.innerWidth;
    uniforms.resolution.value.y = window.innerHeight;
    uniforms.mouse.value.x = 0;
    uniforms.mouse.value.y = 0;
    uniforms.volume.value = 0.0;

    var _vertexShader = document.getElementById('vertexshader').textContent;
    var _fragmentShader = document.getElementById('fragmentshader').textContent;

    var _width = window.innerWidth;
    var _height = window.innerHeight;
    var _dom = document.getElementById('container');

    var camera = new THREE.OrthographicCamera(-_width * 0.5, _width * 0.5, _height * 0.5, -_height * 0.5, 0.1, 2000);
    //camera = new THREE.PerspectiveCamera( 35, _width / _height, 0.1, 2000 );
    camera.position.z = 1000;
    var focus = new THREE.Vector3();
    focus.set(0, 0, 0);
    camera.lookAt(focus);

    var scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x000000, 1200, 1500);
	//	renderer
	renderer = new THREE.WebGLRenderer({ antialias: false });
	renderer.setClearColor(scene.fog.color, 1);
	renderer.setSize(_width,_height);
	_dom.appendChild(renderer.domElement);

    var geometry = new THREE.PlaneGeometry(_width, _height, 1, 1 );
    var material = new THREE.ShaderMaterial({
        uniforms: uniforms,
        vertexShader: _vertexShader,
        fragmentShader: _fragmentShader
    });
    var mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    setInterval(function(){
    	uniforms.time.value += 0.05;
        camera.lookAt(focus);
        renderer.render(scene,camera);
    },1000/60);

})();
</script>
</body>
</html>