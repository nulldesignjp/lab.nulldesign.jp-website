(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{184:function(e,t,o){var content=o(195);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(63).default)("31b988b4",content,!0,{sourceMap:!1})},185:function(e,t,o){var content=o(197);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(63).default)("6759f5ab",content,!0,{sourceMap:!1})},194:function(e,t,o){"use strict";var r=o(184);o.n(r).a},195:function(e,t,o){(t=o(62)(!1)).push([e.i,".artwork{z-index:-1}.artwork,.artwork__canvas,.artwork__video{position:fixed;left:0;top:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.artwork__canvas,.artwork__video{display:block;z-index:-2}.artwork__video{-o-object-fit:fill;object-fit:fill}.artwork__button{position:fixed;left:16px;top:92px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:2;font-size:1.2em}.artwork__button.hide{display:none}",""]),e.exports=t},196:function(e,t,o){"use strict";var r=o(185);o.n(r).a},197:function(e,t,o){(t=o(62)(!1)).push([e.i,"body,html{overflow:hidden;font-family:Heebo}body{background:#000}.title{margin:16px 16px 0;padding:4px 4px 0}.description,.title{line-height:1;font-weight:400;background:hsla(0,0%,100%,.2);font-weight:100}.description{margin:0 16px;padding:0 4px 4px;font-size:1em}",""]),e.exports=t},202:function(e,t,o){"use strict";o.r(t);var r,n=o(179),c=o(180),l=(o(20),o(21),o(13),o(187),o(199),o(200),o(201),o(186),o(181),o(189),o(182),o(190),o(183),o(191));var d,h,v=function(){function e(t,o,c){Object(n.a)(this,e),r=this,this.scene,this.camera,this.focus,this.renderer,this.directional,this.ambient,this.clock,this.time,this.timeScale,this.animationKey,this.controls,this.raycaster,this.composer,o=null==o?16777215:o,c=null==c?0:c,this.init(t,o),window.addEventListener("resize",r.resize),this.resize()}return Object(c.a)(e,[{key:"init",value:function(e,t){this.clock=new THREE.Clock,this.time=0;var o=window.innerWidth,r=window.innerHeight;this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(60,o/r,.01,1e3),this.camera.position.set(0,0,500),this.focus=new THREE.Vector3(0,0,0),this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:e,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(o,r),this.renderer.setClearColor(t),this.renderer.autoClearColor=!1,this.renderer.autoClear=!1,this.renderer.render(this.scene,this.camera),this.controls=new l.a(this.camera,this.renderer.domElement),this.controls.autoRotate=!1,this.controls.autoRotateSpeed=.2,this.controls.enableDamping=!0,this.controls.dampingFactor=.15,this.controls.enableZoom=!0,this.controls.enabled=!0,this.controls.target=this.focus,this.raycaster=new THREE.Raycaster}},{key:"render",value:function(){r.animationKey=window.requestAnimationFrame((function(e){r.render(e)}));var e=r.clock.getDelta();r.time+=e*r.timeScale,r.renderer.render(r.scene,r.camera)}},{key:"resize",value:function(){console.log("resize....");var e=window.innerWidth,t=window.innerHeight;r.renderer.setSize(e,t),r.camera.aspect?r.camera.aspect=e/t:(r.camera.left=.5*-e,r.camera.right=.5*e,r.camera.bottom=.5*-t,r.camera.top=.5*t),r.camera.updateProjectionMatrix()}},{key:"getWorldToScreen2D",value:function(e){var t=new THREE.Vector3,o=this.renderer.getContext(),r=.5*o.canvas.width,n=.5*o.canvas.height;e.updateMatrixWorld(),t.setFromMatrixPosition(e.matrixWorld),t.project(this.camera),t.x=t.x*r+r,t.y=-t.y*n+n;var c=(new THREE.Vector3).subVectors(this.focus,this.camera.position),l=(new THREE.Vector3).subVectors(e.position,this.camera.position);return c.dot(l)<=0&&(t.x=-9999,t.y=-9999),{x:t.x,y:t.y}}},{key:"mouseclick",value:function(e){var t,o=new THREE.Vector2;o.x=e.clientX/window.innerWidth*2-1,o.y=-e.clientY/window.innerHeight*2+1,r.raycaster.setFromCamera(o,r.camera);var n=r.raycaster.intersectObjects(r.scene.children);console.log(n.length),n.length>0?t!=n[0].object&&(t&&t.material.emissive.setHex(t.currentHex),(t=n[0].object).currentHex=t.material.emissive.getHex(),t.material.emissive.setHex(16711680)):(t&&t.material.emissive.setHex(t.currentHex),t=null)}},{key:"focalLengthToFOV",value:function(e){var t=this.camera.filmGauge,o=2*t/3,r=Math.sqrt(t*t+o*o);this.camera.fov=180/Math.PI*Math.atan(r/(2*e))*2,this.camera.updateProjectionMatrix()}},{key:"pixelEqualMagnification",value:function(){return.5*window.innerHeight/Math.tan(.5*_world.camera.fov*Math.PI/180)}},{key:"add",value:function(e){this.scene.add(e)}},{key:"remove",value:function(e){this.scene.remove(e)}},{key:"renderStart",value:function(){this.renderStop(),this.clock.start(),this.render(0)}},{key:"renderStop",value:function(){window.cancelAnimationFrame(this.animationKey),this.clock.stop()}}]),e}(),m=function(){function e(t){Object(n.a)(this,e),d=this,this.world=t,this.distance,this.fireHeight,this.textures,this.particles,this.fireworks,this.init()}return Object(c.a)(e,[{key:"init",value:function(){this.distance=200,this.fireHeight=100,this.textures=[(new THREE.TextureLoader).load("/koi/webar/assets/img/spark1.png"),(new THREE.TextureLoader).load("/koi/webar/assets/img/circle1.png")],this.particles=[],this.fireworks=[];var e=new THREE.Geometry;e.vertices[0]=new THREE.Vector3(-50,0,0),e.vertices[1]=new THREE.Vector3(50,0,0);var t=new THREE.LineBasicMaterial({transparent:!0,opacity:.2}),o=new THREE.Line(e,t);this.world.add(o),o.position.z=-this.distance}},{key:"update",value:function(){d.updateFireWorks(),d.updateParticles()}},{key:"addFire",value:function(e){d.createFireWorks(e)}},{key:"removeFire",value:function(){}},{key:"createFireWorks",value:function(e){console.log("createFireWorks",e);var t=~~((e.fworkHueMax-e.fworkHueMin)*Math.random())+e.fworkHueMin;t/=360;for(var o=new THREE.BufferGeometry,r=[],n=[],c=[],l=[],h=new THREE.Color,i=0;i<64;i++)r.push(0),r.push(0),r.push(0),h.setHSL(t,1,.5),n.push(h.r,h.g,h.b),c.push(i/64*i/64*i/64*i/64*i/64*3),l.push(64-i);o.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),o.setAttribute("colors",new THREE.Float32BufferAttribute(n,3)),o.setAttribute("size",new THREE.Float32BufferAttribute(c,1).setUsage(THREE.DynamicDrawUsage)),o.setAttribute("idx",new THREE.Float32BufferAttribute(l,1).setUsage(THREE.DynamicDrawUsage));var v=new THREE.ShaderMaterial({uniforms:{time:{value:0},texture:{value:d.textures[1]}},vertexShader:["uniform float time;","attribute float size;","attribute float idx;","attribute vec3 colors;","varying float vIdx;","varying float rand;","varying vec3 vColors;","highp float random(vec2 co){","    highp float a = 12.9898;","    highp float b = 78.233;","    highp float c = 43758.5453;","    highp float dt= dot(co.xy ,vec2(a,b));","    highp float sn= mod(dt,3.14);","    return fract(sin(sn) * c);","}","","float noise2(vec2 st)","{","    vec2 p = floor(st);","    return random(p);","}","","float noise3(vec2 st)","{","    vec2 p = floor(st);","    return random(p + vec2(time,0.0));","}","","float valueNoise(vec2 st)","{","    vec2 p = floor(st);","    vec2 f = fract(st);","","    float v00 = random( p + vec2( 0, 0 ) );","    float v10 = random( p + vec2( 1, 0 ) );","    float v01 = random( p + vec2( 0, 1 ) );","    float v11 = random( p + vec2( 1, 1 ) );","","    vec2 u = f * f * (3.0 - 2.0 * f);","","    float v0010 = mix(v00, v10, u.x);","    float v0111 = mix(v01, v11, u.x);","    return mix(v0010, v0111, u.y);","}","","vec2 random2(vec2 st){","       vec2 _st = vec2( dot(st,vec2(127.1,311.7)),","                      dot(st,vec2(269.5,183.3)));","       return -1.0 + 2.0 * fract( sin(_st) * 43758.5453123 );","   }","","float perlinNoise(vec2 st)","{","    vec2 p = floor(st);","    vec2 f = fract(st);","    vec2 u = f*f*(3.0-2.0*f);","","    vec2 v00 = random2( p + vec2(0,0) );","    vec2 v10 = random2( p + vec2(1,0) );","    vec2 v01 = random2( p + vec2(0,1) );","    vec2 v11 = random2( p + vec2(1,1) );","","    return mix( mix( dot( v00, f - vec2(0,0) ), dot( v10, f - vec2(1,0) ), u.x ),","                 mix( dot( v01, f - vec2(0,1) ), dot( v11, f - vec2(1,1) ), u.x ),","                 u.y ) + 0.5;","}","","float fBm (vec2 st)","{","    float f = 0.0;","    vec2 q = st;","","    f += 0.5000 * perlinNoise( q ); q = q*2.01;","    f += 0.2500 * perlinNoise( q ); q = q*2.02;","    f += 0.1250 * perlinNoise( q ); q = q*2.03;","    f += 0.0625 * perlinNoise( q ); q = q*2.01;","","    return f;","}","void main() {","\tvec3 pos = position;","\tpos.y +=  - idx * 0.6;","\tpos.x += ( perlinNoise( pos.yz * 2.1 + vec2(time,time) ) - 0.5 ) * 0.75;","\tpos.z += ( perlinNoise( pos.xy * 2.1 - vec2( -time, -time ) ) - 0.5 ) * 0.75;","\tvIdx = 1.0 - idx / 64.0;","\trand = perlinNoise( pos.yz * 12.1 + vec2( time, 0.0 ) ) * 0.5 + 0.5;","\tvColors = colors;","\tvec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","   gl_PointSize = size * (800.0 / length(mvPosition.xyz));","gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform sampler2D texture;","varying float vIdx;","varying float rand;","varying vec3 vColors;","void main( void ) {","\tvec4 tex = texture2D( texture, gl_PointCoord );","\tgl_FragColor = tex * vec4( vColors, 1.0 );","\tgl_FragColor.a *= vIdx * vIdx * vIdx * rand;","}"].join("\n"),blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0,vertexColors:!0}),m=new THREE.Points(o,v);d.world.add(m),m.position.x=e.position.x,m.position.y=e.position.y,m.position.z=e.position.z,e.start=new THREE.Vector3,e.end=new THREE.Vector3(0,d.fireHeight,0);var f={};f.mesh=m,f.param=e,d.fireworks.push(f)}},{key:"updateFireWorks",value:function(){for(var e=this.fireworks.length;e;){e--;var t=this.fireworks[e].mesh,o=this.fireworks[e].param;t.material.uniforms.time.value+=1/60,t.position.y+=o.fworkSpeed,t.position.y>d.fireHeight&&(o.start=t.position.clone(),d.world.remove(t),o.mesh=null,d.createParticles(o),d.fireworks.splice(e,1),t.geometry.dispose(),null!=t.material.map&&t.material.uniforms.map.dispose(),t.material.dispose(),t.geometry=null,t.material=null,t=null)}}},{key:"createParticles",value:function(e){console.log("createParticles",e);var t=~~((e.partHueMax-e.partHueMin)*Math.random())+e.partHueMin;t/=360;for(var o=e.partCount,r=new THREE.Geometry,i=0;i<o;i++){var n=5*(1-Math.random()*Math.random()),c=Math.acos(2*i/o-1),l=Math.sqrt(o*Math.PI)*c;r.vertices[i]=new THREE.Vector3,r.vertices[i].setFromSphericalCoords(n,c,l).multiplyScalar(2)}r.rotateX(Math.random()*Math.PI*2),r.rotateY(Math.random()*Math.PI*2),r.rotateZ(Math.random()*Math.PI*2);var h=new THREE.PointsMaterial({transparent:!0,opacity:1,map:d.textures[0],blending:THREE.AdditiveBlending,depthTest:!1,size:e.partSize,color:(new THREE.Color).setHSL(t,.96,.6+.25*Math.random())}),v=new THREE.Points(r,h);d.world.add(v),v.position.x=e.start.x,v.position.y=e.start.y,v.position.z=e.start.z;var m={};m.mesh=v,m.param=e,d.particles.push(m)}},{key:"updateParticles",value:function(){for(var e=this.particles.length;e;){e--;var t=this.particles[e].mesh,o=this.particles[e].param;o.lifeTime-=1/60,t.material.size=d.easeInExpo(1-o.lifeTime/o.lifeTimeMaster,o.partSize,-o.partSize,1);for(var r=t.geometry.vertices.length;r;){r--;var n=t.geometry.vertices[r].clone();n.normalize();var c=o.lifeTime/o.lifeTimeMaster;t.geometry.vertices[r].add(n.multiplyScalar(c*c*c*o.partSpeed));var l=1-c;t.geometry.vertices[r].y-=.5*o.partGravity*l*l}t.geometry.verticesNeedUpdate=!0,o.lifeTime<0&&(d.world.remove(t),o.mesh=null,d.particles.splice(e,1))}}},{key:"dispose",value:function(){}},{key:"easeInExpo",value:function(e,b,t,o){return 0==e?b:t*Math.pow(2,10*(e/o-1))+b-.001*t}}]),e}(),f=o(192),w=o.n(f),E=o(193),y=(o(198),function(){function e(t){Object(n.a)(this,e),this.props=t,this.stats=new w.a,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),h=this,this.world,this.surface,this.raycaster,this.tapPosition,this.objects,this.triangles,this.fireworks,this.doubleAttack,this.loopKey,this.controls,this.init(),this.loop(),this.addVideo(),this.addEvents()}return Object(c.a)(e,[{key:"addDeviceOrientationControls",value:function(){h.props.$button.removeEventListener("mousedown",h.addDeviceOrientationControls),h.controls=new E.a(h.world.camera),h.controls.connect(),console.log("click and new.",h.controls),h.world.camera.position.y=5;window.addEventListener("devicemotion",(function(e){}),!1),this.className=this.className+" hide"}},{key:"init",value:function(){this.world=new v(this.props.$canvas,this.props.$bgColor),this.world.controls.enabled=!1,this.world.renderStart();var e=new THREE.PlaneGeometry(1e3,1e3,1,1);e.rotateX(.5*-Math.PI);var t=new THREE.MeshBasicMaterial({transparent:!0,opacity:0,wireframe:!0});this.surface=new THREE.Mesh(e,t),this.world.add(this.surface),this.raycaster=new THREE.Raycaster,this.tapPosition=new THREE.Vector2,this.objects=[],this.triangles=[],this.doubleAttack=0,this.world.camera.fov=60,this.world.focalLengthToFOV(28),console.log("FOV: ",~~this.world.camera.fov),this.world.camera.position.y=1.6,this.world.camera.position.z=3,this.world.focus=new THREE.Vector3(0,0,0),this.fireworks=new m(this.world);var o=new THREE.Mesh(new THREE.SphereGeometry(.05),new THREE.MeshBasicMaterial({color:13369344}));this.world.add(o)}},{key:"placeObjectTouchHandler",value:function(e){if(e.touches.length,!(e.touches.length>2)){h.tapPosition.x=e.touches[0].clientX/window.innerWidth*2-1,h.tapPosition.y=-e.touches[0].clientY/window.innerHeight*2+1,h.raycaster.setFromCamera(h.tapPosition,h.world.camera);var t=h.raycaster.intersectObject(h.surface);1==t.length&&t[0].object==h.surface&&h.placeObject(t[0].point.x,t[0].point.y,t[0].point.z)}}},{key:"placeObject",value:function(e,t,o){var r=new THREE.IcosahedronGeometry(1,1),n=new THREE.MeshBasicMaterial({wireframe:!0,transparent:!0,color:new THREE.Color(Math.random(),Math.random(),Math.random())}),c=new THREE.Mesh(r,n);c.position.set(e,t,o),c.rotation.x=Math.random()*Math.PI*2,c.rotation.y=Math.random()*Math.PI*2,h.world.add(c),c.scale.set(.01,.01,.01),h.objects.push(c)}},{key:"fire",value:function(){var e=h.world.time;if(!(e-h.doubleAttack<.1)){h.doubleAttack=e,console.log("FIRE!");var t=new THREE.Vector3;t.x=100*(Math.random()-.5),t.z=-h.fireworks.distance;for(var o=.5*Math.random(),r=30*~~(9*Math.random()),i=0;i<3;i++){var n=r+30*(i+1),c={lifeTime:1.2,lifeTimeMaster:1.2,partCount:100+~~(100*Math.random()),position:t,partSpeed:1+.5*i,partSpeedVariance:10,partSize:5+3*Math.random(),partWind:50,partFriction:5,partGravity:.5,flickerDensity:25,partHueMin:r,partHueMax:n,partHueVariance:30,fworkSpeed:1+o,fworkAccel:10,fworkGravity:1,fworkHueMin:r,fworkHueMax:n,fworkHueVariance:30};c.startPos=new THREE.Vector3(0,0,-h.distance),h.fireworks.addFire(c)}for(i=0;i<16;i++){var l=h.triangle();l.position.x=h.world.camera.position.x+12*(Math.random()-.5),l.position.y=h.world.camera.position.y+10*(Math.random()-.5),l.position.z=h.world.camera.position.z+12*(Math.random()-.5),l.rotation.x=Math.random()*Math.PI*2,l.rotation.y=Math.random()*Math.PI*2,l.rotation.z=Math.random()*Math.PI*2,h.world.add(l),h.triangles.push(l)}}}},{key:"loop",value:function(){h.stats.begin(),null!=h.controls&&h.controls.update();for(var e=h.objects.length;e;){e--;var t=(o=h.objects[e]).scale.x;t+=.1*(1-t),o.scale.set(t,t,t),o.material.opacity=1-t,o.rotation.x+=.01,o.rotation.y+=.01,o.rotation.z+=.01,1-t<.01&&(h.objects.splice(e,1),h.world.remove(o),o.geometry.dispose(),null!=o.material.map&&o.material.map.dispose(),o.material.dispose(),o.geometry=null,o.material=null,o=null)}for(e=h.triangles.length;e;){var o;e--,(o=h.triangles[e]).rotation.x-=.01,o.rotation.y-=.01,o.position.y+=.025;t=o.position.x;var r=o.position.z;if(o.position.x=Math.cos(.01)*t-Math.sin(.01)*r,o.position.z=Math.sin(.01)*t+Math.cos(.01)*r,o.position.y>25){h.world.remove(o);for(var i=0;i<o.children.length;i++)h.world.remove(o.children[i]);h.triangles.splice(e,1)}}h.loopKey=window.requestAnimationFrame(h.loop),h.fireworks.update(),h.stats.end()}},{key:"resize",value:function(e){h.props.$video.style.width=window.innerWidth+"px",h.props.$video.style.height=window.innerHeight+"px"}},{key:"addEvents",value:function(){h.props.$button.addEventListener("mousedown",h.addDeviceOrientationControls),h.props.$canvas.addEventListener("touchstart",h.placeObjectTouchHandler),h.props.$canvas.addEventListener("touchmove",h.placeObjectTouchHandler),window.addEventListener("keydown",h.fire),window.addEventListener("touchstart",h.fire),window.addEventListener("resize",h.resize)}},{key:"removeEvents",value:function(){h.props.$button.removeEventListener("mousedown",h.addDeviceOrientationControls),h.props.$canvas.removeEventListener("touchstart",h.placeObjectTouchHandler),h.props.$canvas.removeEventListener("touchmove",h.placeObjectTouchHandler),window.removeEventListener("keydown",h.fire),window.removeEventListener("touchstart",h.fire),window.removeEventListener("resize",h.resize)}},{key:"addVideo",value:function(){var e=window.innerWidth,t=window.innerHeight;this.video=this.props.$video,this.video.style.width=window.innerWidth+"px",this.video.style.height=window.innerHeight+"px",this.video.autoplay=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:{exact:"environment"},aspectRatio:t/e}}).then((function(e){h.video.srcObject=e}))}},{key:"triangle",value:function(){for(var e=new THREE.Geometry,t=.4*Math.random()+.1,i=0;i<3;i++){var o=i/3*Math.PI*2;e.vertices.push(new THREE.Vector3(Math.cos(o)*t,0,Math.sin(o)*t))}e.faces.push(new THREE.Face3(0,1,2)),e.computeBoundingSphere();var r=new THREE.Color(.05*Math.random()+.05,.45,.9),n=new THREE.MeshBasicMaterial({wireframe:!1,side:THREE.DoubleSide,transparent:!0,opacity:.1+.1*Math.random(),blending:THREE.AdditiveBlending,depthTest:!1,color:r}),c=new THREE.Mesh(e,n),l=new THREE.MeshBasicMaterial({wireframe:!0,transparent:!0,opacity:.1+.2*Math.random(),blending:THREE.AdditiveBlending,depthTest:!1,color:r}),d=new THREE.Mesh(e,l),h=new THREE.PointsMaterial({transparent:!0,opacity:.3+.1*Math.random(),blending:THREE.AdditiveBlending,depthTest:!1,color:r,size:.05}),v=new THREE.Points(e,h),m=new THREE.Object3D;return m.add(c),m.add(d),m.add(v),m}},{key:"dispose",value:function(){}}]),e}()),x={name:"artwork",components:{},props:[],data:function(){return{}},computed:{},mounted:function(){this.artworkGL=new y({$canvas:this.$refs.canvas,$bgColor:526344,$video:this.$refs.video,$button:this.$refs.button})},destroyed:function(){},methods:{}},H=(o(194),o(30)),k={components:{Artwork:Object(H.a)(x,(function(){var e=this.$createElement,t=this._self._c||e;return t("section",{staticClass:"artwork"},[t("video",{ref:"video",staticClass:"artwork__video",attrs:{autoplay:"",playsinline:"true"}}),this._v(" "),t("canvas",{ref:"canvas",staticClass:"artwork__canvas"}),this._v(" "),t("button",{ref:"button",staticClass:"artwork__button"},[this._v("WebARモードをONにする")])])}),[],!1,null,null,null).exports}},M=(o(196),Object(H.a)(k,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"container"},[t("div",[t("Artwork"),this._v(" "),t("h1",{staticClass:"title"},[this._v("WebAR")]),this._v(" "),t("h2",{staticClass:"description"},[this._v("original webar libs. sp only.")])],1)])}),[],!1,null,null,null));t.default=M.exports}}]);